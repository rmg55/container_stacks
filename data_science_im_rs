FROM rowangaffney/data_science_im_rs_step1


#USER root
#RUN apt-get update && \
#	apt-get install -y --no-install-recommends \
#		libapparmor1 \
#		libedit2 \
#		lsb-release \
#		psmisc \
#		libclang-dev \
#		libssl1.0.0

#RUN RSTUDIO_PKG=rstudio-server-1.2.5001-amd64.deb && \
#  wget -q https://download2.rstudio.org/server/trusty/amd64/${RSTUDIO_PKG} && \
#  dpkg -i ${RSTUDIO_PKG} && \
#  rm ${RSTUDIO_PKG} && \
#  apt-get clean && \
#  rm -rf /var/lib/apt/lists/* && \
#  /opt/conda/bin/python -m pip install git+https://github.com/jupyterhub/jupyter-rsession-proxy
  
USER $NB_UID

# R packages
# RUN conda update -n base conda --yes
RUN conda create -n R_geo --yes
RUN conda install -n R_geo -c r r-irkernel rstudio

RUN conda install -n R_geo -c conda-forge --quiet --yes \
  'r-rgdal' \
  'r-gdalutils' \
  'r-raster' \
  'r-snow' \
  'r-sf' \
  'r-gstat' \
  'r-maptools' \
  'r-rgeos' \
  'r-irkernel' \
  'jupyter-rsession-proxy' \
  'r-sp'

RUN jupyter-labextention install jupyterlab_toastify jupyterlab_conda jupyterlab-slurm jupyterlab/server-proxy

#RUN conda install -c conda-forge --quiet --yes h5netcdf
#RUN pip install --quiet h5pyd
  
#RUN conda install -c conda-forge jupyter-rsession-proxy
#RUN jupyter labextension install @oriolmirosa/jupyterlab_materialdarker

#RUN conda config --add channels "conda-forge/label/cf201901"
#RUN conda install -n R_geo -c "conda-forge/label/cf201901" r-rgdal r-gdalutils

RUN fix-permissions /home/$NB_USER
RUN fix-permissions $CONDA_DIR

RUN conda init bash

#ENV PATH="${PATH}:/usr/lib/rstudio-server/bin"
#ENV LD_LIBRARY_PATH="/usr/lib/x86_64-linux-gnu:/opt/conda/lib/R/lib"


#RUN conda activate R_geo
#RUN Rscript -e "install.packages('neonUtilities',repos = 'http://cran.us.r-project.org')"
